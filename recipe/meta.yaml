{% set version = "0.9.5" %}
{% set build_number = 0 %}

# TODO: more elegant way to get at CONDA_SUBDIR
{% set on_linux_py37 = PY_VER == "3.7" and "linux-64" in compiler("c") %}
{% set on_linux_py38 = PY_VER == "3.8" and "linux-64" in compiler("c") %}

package:
  name: dagster
  version: {{ version }}

source:
  # this should always be built
  - folder: dagster
    url: https://pypi.io/packages/source/d/dagster/dagster-{{ version }}.tar.gz
    sha256: 1575c3735688b754734510d737e345d58a198caeeddbe1a200c6b6bbe3f437ac

  {% if on_linux_py37 or on_linux_py38 %}
  # these are generally safe to build wherever, but are also required for special builds
  - folder: dagster-graphql
    url: https://pypi.io/packages/source/d/dagster-graphql/dagster-graphql-{{ version }}.tar.gz
    sha256: fdc9a6bb97bf877176daa5cd89aab9728c1a4a1219a712c70dafcfa81e2ea239
  {% endif %}

  {% if on_linux_py37 %}
  # these are problematic, and presently build only/most reliably on linux/37
  # along with their dependencies. always download them anyway so they can be found
  # when rendering the recipe to fetch the shas
  - folder: dagster-airflow
    url: https://pypi.io/packages/source/d/dagster-airflow/dagster-airflow-{{ version }}.tar.gz
    sha256: 8d4b4efbe426314fde94ecfb29c1bfb0adc0210db78b1db34b1f22d583cc3be1

  - folder: dagster-aws
    url: https://pypi.io/packages/source/d/dagster-aws/dagster-aws-{{ version }}.tar.gz
    sha256: 028e1107ef8146f3d653353a4f798d062dcde4327b796ffd2cc122958c8d2786

  # - folder: dagster-azure
  #   url: https://pypi.io/packages/source/d/dagster-azure/dagster-azure-{{ version }}.tar.gz
  #   sha256: d6d46a3f6e855815926dd59b6d701f95465e5487a28f88653ca73982e1d37179

  - folder: dagster-celery
    url: https://pypi.io/packages/source/d/dagster-celery/dagster-celery-{{ version }}.tar.gz
    sha256: 2bed285d19e8bec2fa62c513a8c0a34e797aa681f89721adaad9bb846ec4613e

  - folder: dagster-celery-docker
    url: https://pypi.io/packages/source/d/dagster-celery-docker/dagster-celery-docker-{{ version }}.tar.gz
    sha256: 824685086d3741b43bc6dddea15d2edbdd7f08148983a925918e851cad0da2ec

  - folder: dagster-dask
    url: https://pypi.io/packages/source/d/dagster-dask/dagster-dask-{{ version }}.tar.gz
    sha256: 701118d052bdc5585e271341d1330d6b33551240940143d0d0b3eca2550e144d

  - folder: dagster-gcp
    url: https://pypi.io/packages/source/d/dagster-gcp/dagster-gcp-{{ version }}.tar.gz
    sha256: 7a165387ceb7a713308d14212dddf316acca6435d217a57e81d68a2ffe1f78c1

  - folder: dagster-ge
    url: https://pypi.io/packages/source/d/dagster-ge/dagster-ge-{{ version }}.tar.gz
    sha256: bae7af12e6e39b769b7454d939f8f8662a9c16be0c70e5efbe293d3c01c00860

  - folder: dagster-pyspark
    url: https://pypi.io/packages/source/d/dagster-pyspark/dagster-pyspark-{{ version }}.tar.gz
    sha256: ca4638f32253bb69975f3de525e3cceb0bc05fcd8e44f0dd31e048ac24fdc8bb

  - folder: dagstermill
    url: https://pypi.io/packages/source/d/dagstermill/dagstermill-{{ version }}.tar.gz
    sha256: 8e1491407ef4ff3d0805598cc0d730a8b315ed6844459159c7bd29801d118255

  - folder: dagster-celery-k8s
    url: https://pypi.io/packages/source/d/dagster-celery-k8s/dagster-celery-k8s-{{ version }}.tar.gz
    sha256: 29e45e29689342af79e719c4080b0520d6e0e399873f811d5405b6048436bc10
  {% endif %}

  {% if on_linux_py38 %}
  # these are generally safe to build wherever, but can be built most quickly on linux/38
  - folder: dagit
    url: https://pypi.io/packages/source/d/dagit/dagit-{{ version }}.tar.gz
    sha256: 423c58e478fa3b07ba9e6c4f516086c15ea5ae88ab787bdbea7e164bc80f0b86

  - folder: dagster-shell
    url: https://pypi.io/packages/source/d/dagster-shell/dagster-shell-{{ version }}.tar.gz
    sha256: 21f5d30fa7731a27c4da2584949eeefad4d24a7dd10d1fee452981c7c695f437

  - folder: dagster-cron
    url: https://pypi.io/packages/source/d/dagster-cron/dagster-cron-{{ version }}.tar.gz
    sha256: 468d830c711f1e49b73f0d35a88867b061be9a0503461260ef193299909c1570

  - folder: dagster-datadog
    url: https://pypi.io/packages/source/d/dagster-datadog/dagster-datadog-{{ version }}.tar.gz
    sha256: 4ab5271e3922d25263a6257f0169780d0634cea750028afdc9dff6c9dd4b702d

  - folder: dagster-dbt
    url: https://pypi.io/packages/source/d/dagster-dbt/dagster-dbt-{{ version }}.tar.gz
    sha256: b4b45355c8acfdc4bc575a2701659348a3c36155e2f2e3ce040ffd3f1e5420eb

  - folder: dagster-github
    url: https://pypi.io/packages/source/d/dagster-github/dagster-github-{{ version }}.tar.gz
    sha256: 6eec53d45e76253417d8fff16ea4a15cf2660ee2ed2480ab386b153133f04112

  - folder: dagster-k8s
    url: https://pypi.io/packages/source/d/dagster-k8s/dagster-k8s-{{ version }}.tar.gz
    sha256: c04ce1737ab7ef962ed885a37203dc2208066254cb5b0da6b7ac85ca7bf3af0b

  - folder: dagster-pagerduty
    url: https://pypi.io/packages/source/d/dagster-pagerduty/dagster-pagerduty-{{ version }}.tar.gz
    sha256: 074b8df306a505119882b454e9153931a7716249cc20360fb3ab8107bb5510ce

  - folder: dagster-pandas
    url: https://pypi.io/packages/source/d/dagster-pandas/dagster-pandas-{{ version }}.tar.gz
    sha256: b62528ad2f45a98edc41465464294593ce871a367d56b968d22aa49ef979df94

  - folder: dagster-papertrail
    url: https://pypi.io/packages/source/d/dagster-papertrail/dagster-papertrail-{{ version }}.tar.gz
    sha256: 74549aa34ce7df34329fc5a36cf4f58ac252571f5f9192c3abf76d3c6a36b910

  - folder: dagster-postgres
    url: https://pypi.io/packages/source/d/dagster-postgres/dagster-postgres-{{ version }}.tar.gz
    sha256: 511258dd81e808f34ab9580221792e8cbc04918844a9f0b7e97ab85e96621329

  - folder: dagster-prometheus
    url: https://pypi.io/packages/source/d/dagster-prometheus/dagster-prometheus-{{ version }}.tar.gz
    sha256: e2f0e33b886638870bc2a0608e5aaff6df4f1fc0d909f0d3af6d0bf29b38a26f

  - folder: dagster-slack
    url: https://pypi.io/packages/source/d/dagster-slack/dagster-slack-{{ version }}.tar.gz
    sha256: 31ea91c96a4bc18a366f15eac5fefeb462ac67767da12ad69572a96d308e5abe

  - folder: dagster-snowflake
    url: https://pypi.io/packages/source/d/dagster-snowflake/dagster-snowflake-{{ version }}.tar.gz
    sha256: b6942b2f33fc4b7cf4c389aac42e74dbba14a9747adb6ffff04ea1261d0e059b

  - folder: dagster-spark
    url: https://pypi.io/packages/source/d/dagster-spark/dagster-spark-{{ version }}.tar.gz
    sha256: 853c7d8b815a225f5f368bc554dd182ad3743dfa44158efe3d843fb656b31259

  - folder: dagster-ssh
    url: https://pypi.io/packages/source/d/dagster-ssh/dagster-ssh-{{ version }}.tar.gz
    sha256: 7f64b94ce2c767921d20326c9c73b35fc1cd7996d21a9672d09510e00ce4c820

  - folder: dagster-twilio
    url: https://pypi.io/packages/source/d/dagster-twilio/dagster-twilio-{{ version }}.tar.gz
    sha256: d7a9eb2214b4e715b8d7de7c71d98375554ac4b6f2694da5dc6ab6be475734c9
  {% endif %}

build:
  number: {{ build_number }}


requirements:
  host:
    - python
  run:
    - python


test:
  commands:
    - echo "TODO"


outputs:
  # all platform/python versions
  - name: dagster
    build:
      number: {{ build_number }}
      entry_points:
        - dagster = dagster.cli:main
      script: cd dagster && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - alembic >=1.2.1
        - click >=5.0
        - coloredlogs >=6.1
        - contextlib2 >=0.5.4
        - docstring_parser ==0.7.1
        - enum-compat >=0.0.1
        - funcsigs
        - future
        - grpcio ==1.30.0
        - protobuf ==3.12.4
        - psutil >=1.0  # [win]
        - pyrsistent >=0.14.8
        - python
        - python-dateutil
        - pytz
        - pywin32 !=226  # [win]
        - pyyaml
        - requests
        - rx <=1.6.1
        - setuptools          # undeclared dep
        - six
        - sqlalchemy >=1.0
        - toposort >=1.0
        - tqdm
        - watchdog >=0.8.3
        # historical py2k packages
        # - functools32  # [py2k]
        # - backports.tempfile  # [py2k]
        # - typing  # [py2k]
        # - pathlib2 >=2.3.4  # [py2k]

    test:
      requires:
        - pip
      imports:
        - dagster
        - dagster.check
        - dagster.cli
        - dagster.core
        - dagster.core.definitions
        - dagster.core.engine
        - dagster.core.events
        - dagster.core.execution
        - dagster.core.execution.context
        - dagster.core.execution.plan
        - dagster.core.instance
        - dagster.core.scheduler
        - dagster.core.selector
        - dagster.core.serdes
        - dagster.core.storage
        - dagster.core.system_config
        - dagster.core.types
        - dagster.core.types.evaluator
        - dagster.loggers
        - dagster.seven
        - dagster.utils
      commands:
        - dagster --help
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster
      license: Apache-2.0
      license_family: APACHE
      summary: Dagster is a data orchestrator for machine learning, analytics, and ETL.
      license_file: dagster/LICENSE

  {% if on_linux_py37 or on_linux_py38 %}
  # needed by both
  - name: dagster-graphql
    build:
      number: {{ build_number }}
      noarch: python
      entry_points:
        - dagster-graphql = dagster_graphql.cli:main
      script: cd dagster-graphql && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - gevent
        - gevent-websocket >=0.10.1
        - graphene >=2.1.3
        - python
        - requests

    test:
      requires:
        - pip
      imports:
        - dagster_graphql
        - dagster_graphql.client
        - dagster_graphql.schema
      commands:
        - dagster-graphql --help
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-graphql
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-graphql/LICENSE
      summary: The GraphQL frontend to python dagster.
  {% endif %}

  {% if on_linux_py37 %}
  - name: dagster-celery
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-celery && {{ PYTHON }} -m pip install . -vv --no-deps
      entry_points:
        - dagster-celery = dagster_celery.cli:main

    requirements:
      host:
        - pip
        - python
      run:
        - celery >=4.3.0
        - click >=5.0
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_celery
      commands:
        - dagster-celery --help
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/blob/master/python_modules/dagster-celery
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-celery/LICENSE
      summary: Package for using Celery as Dagster's execution engine.

  - name: dagster-celery-docker
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-celery-docker && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - dagster-celery {{ version }}.*
        - docker-py
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_celery_docker
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/blob/master/python_modules/dagster-celery-docker
      license: Apache-2.0
      license_family: APACHE
      # TODO: make upstream issue
      license_file: dagster/LICENSE
      summary: A Dagster integration for celery-docker

  # issues with python 2.7
  - name: dagster-dask
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-dask && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python >=3
      run:
        - bokeh
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - dask >=1.2.2
        - distributed >=1.28.1
        - python >=3

    test:
      requires:
        - pip
      imports:
        - dagster_dask
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-dask
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-dask/LICENSE
      summary: Package for using Dask as Dagster's execution engine.
  {% endif %}

  {% if on_linux_py37 and build_number > 0 %}
  # these _would_ build on py37_0, except conda-build tries to test them with py38
  # issues with win/python 2.7
  - name: dagster-gcp
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-gcp && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python <3.8.0a0
      run:
        - dagster
        - dagster-pandas
        - google-api-python-client
        # TODO as of #39 google-api-core 1.20.0, importing bigquery presently fails with
        #
        #   AttributeError: module 'google.api_core' has no attribute 'gapic_v1'`
        #
        # which uncovers a whole separate can of worms down to grpcio
        - google-api-core !=1.20.0
        - google-cloud-bigquery-core >=1.19
        - google-cloud-storage
        - google-resumable-media
        - oauth2client
        - python <3.8.0a0

    test:
      requires:
        - pip
      imports:
        - dagster_gcp
        - dagster_gcp.bigquery
        - dagster_gcp.dataproc
        - dagster_gcp.gcs
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-gcp
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-gcp/LICENSE
      summary: Package for GCP-specific Dagster framework solid and resource components.

  # issues with python 3.8
  - name: dagster-pyspark
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-pyspark && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - dagster-spark {{ version }}.*
        - pyspark
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_pyspark
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-framework/pyspark
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-pyspark/LICENSE
      summary: Package for PySpark Dagster framework components.

  # issues with python 2.7
  - name: dagstermill
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagstermill && {{ PYTHON }} -m pip install . -vv --no-deps
      entry_points:
        - dagstermill = dagstermill.cli:main

    requirements:
      host:
        - pip
        - python >=3.5
      run:
        - dagster {{ version }}.*
        - ipykernel >=4.9.0
        - nteract-scrapbook >=0.2.0
        - papermill >=1.0.0,<2.0.0
        - python >=3.5
        - six

    test:
      requires:
        - pip
      imports:
        - dagstermill
      commands:
        - dagstermill --help
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagstermill
      license: Apache-2.0
      license_family: APACHE
      license_file: dagstermill/LICENSE
      summary: A Dagster integration for papermill

  - name: dagster-ge
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-ge && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python >=3
      run:
        - dagster {{ version }}.*
        - dagster-pandas {{ version }}.*
        - great-expectations >=0.11.9
        - python >=3
        # TODO: upstream
        - requests <2.24,>=2.20

    test:
      requires:
        - pip
      imports:
        - dagster_ge
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-ge
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-ge/LICENSE
      summary: Package for GE-specific Dagster framework solid and resource components.

  # issues with python 3.8
  - name: dagster-airflow
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-airflow && {{ PYTHON }} -m pip install . -vv --no-deps
      entry_points:
        - dagster-airflow = dagster_airflow.cli:main

    requirements:
      host:
        - pip
        - python <3.8.0a0
      run:
        - airflow
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - docker-py
        - lazy-object-proxy
        - pendulum ==1.4.4
        - python <3.8.0a0
        - python-dateutil >=2.8.0
        - six

    test:
      # requires:
      #   - pip
      requires:
        - python <3.8.0a0
      imports:
        - dagster_airflow
      commands:
        - dagster-airflow --help
        # cannot be pip-checked because:
        #
        #   flask-admin 1.5.4 requires enum34, which is not installed.
        # - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-airflow
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-airflow/LICENSE
      summary: Airflow plugin for Dagster

  # issues with python 3.8
  - name: dagster-aws
    build:
      noarch: python
      number: {{ build_number }}
      script: cd dagster-aws && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python <3.8.0a0
      run:
        - boto3 >=1.9
        - dagster {{ version }}.*
        - psycopg2
        - python <3.8.0a0
        - requests

    test:
      requires:
        - dagster-pyspark
        - python <3.8.0
        # can't be pip checked because of psycopg2-binary
        # - pip
      imports:
        - dagster_aws
        - dagster_aws.cloudwatch
        - dagster_aws.ecs
        - dagster_aws.redshift
        - dagster_aws.s3
        # still seems to be failing
        # - dagster_aws.emr

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-aws
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-aws/LICENSE
      summary: Package for AWS-specific Dagster framework solid and resource components.

  - name: dagster-celery-k8s
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-celery-k8s && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - dagster-celery {{ version }}.*
        - dagster-k8s {{ version }}.*
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_celery_k8s
      commands:
        - python -m pip check

  # azure-storage-file-datalake not available
  # - name: dagster-azure
  #   build:
  #     noarch: python
  #     number: {{ build_number }}
  #     entry_points:
  #       - dagster-azure = dagster_azure.cli.cli:main
  #     script: cd dagster-azure && {{ PYTHON }} -m pip install . -vv --no-deps

  #   requirements:
  #     host:
  #       - pip
  #       - python <3.8.0a0
  #     run:
  #       - dagster {{ version }}.*
  #       - azure-storage-blob >=12.3.0,<12.4.0a0
  #       - azure-storage-file-datalake >=12.0.1,<12.1.0a0

  #   test:
  #     requires:
  #       - python <3.8.0
  #       - pip
  #     imports:
  #       - dagster_azure
  #     commands:
  #       - dagster-azure --help
  #       - python -m pip check

  #   about:
  #     home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-azure
  #     license: Apache-2.0
  #     license_family: APACHE
  #     license_file: dagster-azure/LICENSE
  #     summary: Package for Azure-specific Dagster framework solid and resource components.
  {% endif %}

  {% if on_linux_py38 %}
  # would build wherever, but build fastest here
  - name: dagit
    build:
      number: {{ build_number }}
      noarch: python
      entry_points:
        - dagit = dagit.cli:main
      script: cd dagit && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - click >=7.0
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - enum-compat >=0.0.1
        - flask >=0.12.4
        - flask-cors >=3.0.6
        - flask-graphql >=2.0.0
        - flask-sockets >=0.2.1
        - future
        - gevent
        - gevent-websocket >=0.10.1
        - graphql-core >=2.1,<3
        - graphql-ws >=0.3.0
        - nbconvert >=5.4.0
        - python
        - pyyaml
        - watchdog >=0.8.3

    test:
      requires:
        - pip
      imports:
        - dagit
        - dagit.schema
        - dagit.templates
      commands:
        - python -m pip check
        - dagit --help

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagit
      license: Apache-2.0
      license_family: APACHE
      license_file: dagit/LICENSE
      summary: Dagster UI

  - name: dagster-shell
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-shell && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_shell
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-shell
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-shell/LICENSE
      summary: Package for Dagster shell solids.

  - name: dagster-cron
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-cron && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python
        - python-crontab >=2.3.8

    test:
      requires:
        - pip
      imports:
        - dagster_cron
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-cron
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-cron/LICENSE
      summary: A Dagster integration for cron

  - name: dagster-datadog
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-datadog && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python

      run:
        - dagster {{ version }}.*
        - datadog
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_datadog
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-datadog
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-datadog/LICENSE
      summary: Package for datadog Dagster framework components.

  - name: dagster-dbt
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-dbt && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python >=3
      run:
        - attr
        - dagster {{ version }}.*
        - dagster-pandas {{ version }}.*
        - pandas
        - requests

    test:
      requires:
        - pip
      imports:
        - dagster_dbt
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-dbt
      license: Apache-2.0
      license_family: APACHE
      # TODO: restore after https://github.com/dagster-io/dagster/issues/2881
      license_file: dagster/LICENSE
      summary: A Dagster integration for dbt

  - name: dagster-github
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-github && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - cryptography >=1.4
        - dagster {{ version }}.*
        - pyjwt
        - requests

    test:
      requires:
        - pip
      imports:
        - dagster_github
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-github
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-github/LICENSE
      summary: Github plugin for Dagster

  - name: dagster-k8s
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-k8s && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - dagster-graphql {{ version }}.*
        - python-kubernetes

    test:
      requires:
        - pip
      imports:
        - dagster_k8s
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-k8s
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-github/LICENSE
      summary: A Dagster integration for k8s

    about:
      home: https://github.com/dagster-io/dagster/blob/master/python_modules/dagster-celery-k8s
      license: Apache-2.0
      license_family: APACHE
      # TODO: make upstream issue
      license_file: dagster/LICENSE
      summary: A Dagster integration for celery-k8s-executor

  - name: dagster-pagerduty
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-pagerduty && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - pypd
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_pagerduty
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-pagerduty
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-pagerduty/LICENSE
      summary: Package for pagerduty Dagster framework components.

  - name: dagster-pandas
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-pandas && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - matplotlib-base
        - pandas
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_pandas
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-pandas/LICENSE
      summary: Utilities and examples for working with pandas and dagster, an opinionated framework for expressing data pipelines

  - name: dagster-papertrail
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-papertrail && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_papertrail
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-papertrail
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-papertrail/LICENSE
      summary: Package for papertrail Dagster framework components.

  - name: dagster-postgres
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-postgres && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - psycopg2
        - python

    test:
      # this cannot be `pip check`ed because of the psycopg2[-binary] fiasco
      imports:
        - dagster_postgres

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-postgres
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-postgres/LICENSE
      summary: A Dagster integration for postgres

  - name: dagster-prometheus
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-prometheus && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - prometheus_client
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_prometheus
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-prometheus
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-prometheus/LICENSE
      summary: A Dagster integration for prometheus

  - name: dagster-slack
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-slack && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python
        - slackclient <2
        - websocket-client <0.55.0,>=0.35
        - ssl_match_hostname

    test:
      requires:
        - pip
      imports:
        - dagster_slack
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-slack
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-slack/LICENSE
      summary: A Slack client resource for posting to Slack

  - name: dagster-snowflake
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-snowflake && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - azure-storage-blob <12
        - dagster {{ version }}.*
        - python
        - snowflake-connector-python >=2.1.0

    test:
      requires:
        - pip
      imports:
        - dagster_snowflake
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-snowflake
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-snowflake/LICENSE
      summary: Package for Snowflake Dagster framework components.

  - name: dagster-spark
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-spark && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python

    test:
      requires:
        - pip
      imports:
        - dagster_spark
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-spark
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-spark/LICENSE
      summary: Package for Spark Dagster framework components.

  - name: dagster-ssh
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-ssh && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - paramiko
        - python
        - sshtunnel

    test:
      requires:
        - pip
      imports:
        - dagster_ssh
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-ssh
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-ssh/LICENSE
      summary: Package for ssh Dagster framework components.

  - name: dagster-twilio
    build:
      number: {{ build_number }}
      noarch: python
      script: cd dagster-twilio && {{ PYTHON }} -m pip install . -vv --no-deps

    requirements:
      host:
        - pip
        - python
      run:
        - dagster {{ version }}.*
        - python
        - twilio

    test:
      requires:
        - pip
      imports:
        - dagster_twilio
      commands:
        - python -m pip check

    about:
      home: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-twilio
      license: Apache-2.0
      license_family: APACHE
      license_file: dagster-twilio/LICENSE
      summary: A Dagster integration for twilio
  {% endif %}


about:
  home: https://github.com/dagster-io
  summary: 'A Python library for building data applications: ETL, ML, Data Pipelines, and more.'
  license: Apache-2.0
  license_family: APACHE
  license_file: dagster/LICENSE
  doc_url: https://dagster.readthedocs.io
  description: >-
    Dagster is a system for building modern data applications. Combining an elegant programming model and beautiful tools, Dagster allows infrastructure engineers, data engineers, and data scientists to seamlessly collaborate to process and produce the trusted, reliable data needed in today's world.

extra:
  recipe-maintainers:
    - xhochy
    - bollwyvl
    - mgasner
